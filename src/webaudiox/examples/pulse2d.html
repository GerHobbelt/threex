<!doctype html>
<script src='../contextx.contextx.js'></script>
<script src='../contextx.absolutenormalizer.js'></script>
<script src='../contextx.adaptativenormalizer.js'></script>
<body><script>
	var contextx	= new webaudiox.Contextx()

//	contextx.volume	= 0.1

	var analyser	= contextx.context.createAnalyser()
	analyser.connect(contextx.masterOut);
	contextx.masterOut	= analyser;



	// load a sound and play it immediatly
	contextx.loadBuffer('sounds/perfume.mp3', function(buffer){
		var source	= contextx.context.createBufferSource();
		source.buffer	= buffer;
		source.loop	= true
		source.connect(contextx.masterOut);
		source.start(0);		
	});
	
	// create and add the canvas
	var canvas	= document.createElement('canvas');
	canvas.width	= window.innerWidth;
	canvas.height	= window.innerHeight;
	var ctx		= canvas.getContext("2d");  
	document.body.appendChild(canvas)
		
	setInterval(update, 1000/60);
	
	var normalizer	= new contextx.AdaptativeNormalizer()
	function update(){
		var scale	= contextx.amplitude(analyser)
		scale		= normalizer.update(scale)
		
		// clear the canvas
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		// up to you to find the colors you like
		ctx.fillStyle	= "rgb("+Math.floor(1.3*scale*256)+", 0, 0);";
		// draw a circle
		var radius	= 1+scale * 400;
		ctx.beginPath();
		ctx.arc(canvas.width/2, canvas.height/2, radius, 0, Math.PI*2, true); 
		ctx.closePath();
		ctx.fill();
	}; 

</script></body>